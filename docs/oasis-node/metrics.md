# `oasis-node` Metrics

`oasis-node` can report a number of metrics to Prometheus server. By default, no metrics are
collected and reported. There are two ways to enable metrics reporting:

* *Pull mode* listens on given address and waits for Prometheus to scrape the metrics.
* *Push mode* regularly pushes metrics to the provided Prometheus push gateway.

## Configuring `oasis-node` in Pull Mode

To run `oasis-node` in *pull mode* set flag `--metrics.mode pull` and provide the listen address
with `--metrics.address`. For example

```
oasis-node --metrics.mode pull --metrics.address localhost:3000
```

Then, add the following segment to your `prometheus.yml` and restart Prometheus:

```yaml
  - job_name : 'oasis-node'

    scrape_interval: 5s

    static_configs:
      - targets: ['localhost:3000']
```

## Configuring `oasis-node` in Push Mode

First run Prometheus server and Prometheus push gateway. Then run `oasis-node` in *push mode* by
setting flag `--metrics.mode push` and provide:

* push gateway address with `--metrics.address`, and
* push interval with `--metrics.interval`.

For example:

```
oasis-node --metrics.mode push --metrics.address localhost:9091 --metrics.interval 5s
```

# List of Metrics

## List of Metrics Reported by `oasis-node`

`oasis-node` reports metrics starting with `oasis_`.

The following metrics are currently reported:

<!-- markdownlint-disable line-length -->

<!-- This table was generated by generate-metrics-docs.py -->
Name | Description | Type
---|---|---
go_gc_duration_seconds | A summary of the pause duration of garbage collection cycles. | summary
go_goroutines | Number of goroutines that currently exist. | gauge
go_info | Information about the Go environment. | gauge
go_memstats_alloc_bytes | Number of bytes allocated and still in use. | gauge
go_memstats_alloc_bytes_total | Total number of bytes allocated, even if freed. | counter
go_memstats_buck_hash_sys_bytes | Number of bytes used by the profiling bucket hash table. | gauge
go_memstats_frees_total | Total number of frees. | counter
go_memstats_gc_cpu_fraction | The fraction of this program's available CPU time used by the GC since the program started. | gauge
go_memstats_gc_sys_bytes | Number of bytes used for garbage collection system metadata. | gauge
go_memstats_heap_alloc_bytes | Number of heap bytes allocated and still in use. | gauge
go_memstats_heap_idle_bytes | Number of heap bytes waiting to be used. | gauge
go_memstats_heap_inuse_bytes | Number of heap bytes that are in use. | gauge
go_memstats_heap_objects | Number of allocated objects. | gauge
go_memstats_heap_released_bytes | Number of heap bytes released to OS. | gauge
go_memstats_heap_sys_bytes | Number of heap bytes obtained from system. | gauge
go_memstats_last_gc_time_seconds | Number of seconds since 1970 of last garbage collection. | gauge
go_memstats_lookups_total | Total number of pointer lookups. | counter
go_memstats_mallocs_total | Total number of mallocs. | counter
go_memstats_mcache_inuse_bytes | Number of bytes in use by mcache structures. | gauge
go_memstats_mcache_sys_bytes | Number of bytes used for mcache structures obtained from system. | gauge
go_memstats_mspan_inuse_bytes | Number of bytes in use by mspan structures. | gauge
go_memstats_mspan_sys_bytes | Number of bytes used for mspan structures obtained from system. | gauge
go_memstats_next_gc_bytes | Number of heap bytes when next garbage collection will take place. | gauge
go_memstats_other_sys_bytes | Number of bytes used for other system allocations. | gauge
go_memstats_stack_inuse_bytes | Number of bytes in use by the stack allocator. | gauge
go_memstats_stack_sys_bytes | Number of bytes obtained from system for stack allocator. | gauge
go_memstats_sys_bytes | Number of bytes obtained from system. | gauge
go_threads | Number of OS threads created. | gauge
oasis_abci_db_size | Total size of the ABCI database (MiB). | gauge
oasis_codec_size | CBOR codec message size (bytes). | summary
oasis_finalized_rounds | Number of finalized rounds. | counter
oasis_grpc_calls | Number of gRPC calls. | counter
oasis_grpc_latency | gRPC call latency (seconds). | summary
oasis_node_cpu_stime_seconds | CPU system time spent by worker as reported by /proc/<PID>/stat (seconds). | gauge
oasis_node_cpu_utime_seconds | CPU user time spent by worker as reported by /proc/<PID>/stat (seconds). | gauge
oasis_node_disk_read_bytes | Read data from block storage by the worker as reported by /proc/<PID>/io (bytes). | gauge
oasis_node_disk_usage_bytes | Size of datadir of the worker (bytes). | gauge
oasis_node_disk_written_bytes | Written data from block storage by the worker as reported by /proc/<PID>/io (bytes) | gauge
oasis_node_mem_rss_anon_bytes | Size of resident anonymous memory of worker as reported by /proc/<PID>/status (bytes). | gauge
oasis_node_mem_rss_file_bytes | Size of resident file mappings of worker as reported by /proc/<PID>/status (bytes) | gauge
oasis_node_mem_rss_shmem_bytes | Size of resident shared memory of worker | gauge
oasis_node_mem_vm_size_bytes | Virtual memory size of worker (bytes). | gauge
oasis_node_net_receive_bytes_total | Received data for each network device as reported by /proc/net/dev (bytes). | gauge
oasis_node_net_receive_packets_total | Received data for each network device as reported by /proc/net/dev (packets). | gauge
oasis_node_net_transmit_bytes_total | Transmitted data for each network device as reported by /proc/net/dev (bytes). | gauge
oasis_node_net_transmit_packets_total | Transmitted data for each network device as reported by /proc/net/dev (packets). | gauge
oasis_registry_entities | Number of registry entities. | gauge
oasis_registry_nodes | Number of registry nodes. | gauge
oasis_registry_runtimes | Number of registry runtimes. | gauge
oasis_roothash_block_interval | Time between roothash blocks (seconds). | summary
oasis_storage_latency | Storage call latency (seconds). | summary
oasis_storage_successes | Number of storage successes. | counter
oasis_storage_value_size | Storage call value size (bytes). | summary
oasis_up | Is oasis-test-runner active for specific test. | gauge
oasis_worker_batch_processing_time | Time it takes for a batch to finalize (seconds). | summary
oasis_worker_batch_read_time | Time it takes to read a batch from storage (seconds). | summary
oasis_worker_batch_runtime_processing_time | Time it takes for a batch to be processed by the runtime (seconds). | summary
oasis_worker_batch_size | Number of transactions in a batch. | summary
oasis_worker_epoch_transition_count | Number of epoch transitions. | counter
oasis_worker_processed_block_count | Number of processed roothash blocks. | counter
oasis_worker_roothash_merge_commit_latency | Latency of roothash merge commit (seconds). | summary
oasis_worker_storage_commit_latency | Latency of storage commit calls (state + outputs) (seconds). | summary
oasis_worker_txnscheduler_incoming_queue_size | Size of the incoming queue (number of entries). | gauge
process_cpu_seconds_total | Total user and system CPU time spent in seconds. | counter
process_max_fds | Maximum number of open file descriptors. | gauge
process_open_fds | Number of open file descriptors. | gauge
process_resident_memory_bytes | Resident memory size in bytes. | gauge
process_start_time_seconds | Start time of the process since unix epoch in seconds. | gauge
process_virtual_memory_bytes | Virtual memory size in bytes. | gauge
process_virtual_memory_max_bytes | Maximum amount of virtual memory available in bytes. | gauge
push_failure_time_seconds | Last Unix time when changing this group in the Pushgateway failed. | gauge
push_time_seconds | Last Unix time when changing this group in the Pushgateway succeeded. | gauge
pushgateway_build_info | A metric with a constant '1' value labeled by version, revision, branch, and goversion from which pushgateway was built. | gauge
pushgateway_http_push_duration_seconds | HTTP request duration for pushes to the Pushgateway. | summary
pushgateway_http_push_size_bytes | HTTP request size for pushes to the Pushgateway. | summary
pushgateway_http_requests_total | Total HTTP requests processed by the Pushgateway, excluding scrapes. | counter
tendermint_consensus_block_interval_seconds | Time between this and the last block. | gauge
tendermint_consensus_block_parts | Number of blockparts transmitted by peer. | counter
tendermint_consensus_block_size_bytes | Size of the block. | gauge
tendermint_consensus_byzantine_validators | Number of validators who tried to double sign. | gauge
tendermint_consensus_byzantine_validators_power | Total power of the byzantine validators. | gauge
tendermint_consensus_fast_syncing | Whether or not a node is fast syncing. 1 if yes, 0 if no. | gauge
tendermint_consensus_height | Height of the chain. | gauge
tendermint_consensus_latest_block_height | The latest block height. | gauge
tendermint_consensus_missing_validators | Number of validators who did not sign. | gauge
tendermint_consensus_missing_validators_power | Total power of the missing validators. | gauge
tendermint_consensus_num_txs | Number of transactions. | gauge
tendermint_consensus_rounds | Number of rounds. | gauge
tendermint_consensus_total_txs | Total number of transactions. | gauge
tendermint_consensus_validator_last_signed_height | Last signed height for a validator | gauge
tendermint_consensus_validator_power | Power of a validator | gauge
tendermint_consensus_validators | Number of validators. | gauge
tendermint_consensus_validators_power | Total power of all validators. | gauge
tendermint_mempool_failed_txs | Number of failed transactions. | counter
tendermint_mempool_recheck_times | Number of times transactions are rechecked in the mempool. | counter
tendermint_mempool_size | Size of the mempool (number of uncommitted transactions). | gauge
tendermint_mempool_tx_size_bytes | Transaction sizes in bytes. | histogram
tendermint_p2p_peer_pending_send_bytes | Number of pending bytes to be sent to a given peer. | gauge
tendermint_p2p_peer_receive_bytes_total | Number of bytes received from a given peer. | counter
tendermint_p2p_peer_send_bytes_total | Number of bytes sent to a given peer. | counter
tendermint_p2p_peers | Number of peers. | gauge
tendermint_state_block_processing_time | Time between BeginBlock and EndBlock in ms. | histogram
<!-- End of generated table -->

<!-- markdownlint-enable line-length -->

## List of Metrics Reported by *Tendermint*

Since `oasis-node` uses *Tendermint* for BFT consensus, all *Tendermint* metrics are also reported.
Consult [tendermint-core documentation](https://docs.tendermint.com/master/tendermint-core/metrics.html)
for a list of *Tendermint* metrics.
