# `oasis-node` Metrics

`oasis-node` can report a number of metrics to Prometheus server. By default, no metrics are
collected and reported. There are two ways to enable metrics reporting:

* *Pull mode* listens on given address and waits for Prometheus to scrape the metrics.
* *Push mode* regularly pushes metrics to the provided Prometheus push gateway.

## Configuring `oasis-node` in Pull Mode

To run `oasis-node` in *pull mode* set flag `--metrics.mode pull` and provide the listen address
with `--metrics.address`. For example

```
oasis-node --metrics.mode pull --metrics.address localhost:3000
```

Then, add the following segment to your `prometheus.yml` and restart Prometheus:

```yaml
  - job_name : 'oasis-node'

    scrape_interval: 5s

    static_configs:
      - targets: ['localhost:3000']
```

## Configuring `oasis-node` in Push Mode

First run Prometheus server and Prometheus push gateway. Then run `oasis-node` in *push mode* by
setting flag `--metrics.mode push` and provide:

* push gateway address with `--metrics.address`, and
* push interval with `--metrics.interval`.

For example:

```
oasis-node --metrics.mode push --metrics.address localhost:9091 --metrics.interval 5s
```

# List of Metrics

## List of Metrics Reported by `oasis-node`

`oasis-node` reports metrics starting with `oasis_`.

The following metrics are currently reported:

<!-- markdownlint-disable line-length -->

<!-- This table was generated by generate-metrics-docs.py -->
Name | Description | Package
-----|-------------|--------
oasis_abci_db_size | Total size of the ABCI database (MiB). | [consensus/tendermint/abci](../../go/consensus/tendermint/abci/mux.go#L45)
oasis_codec_size | CBOR codec message size (bytes). | [common/cbor](../../go/common/cbor/codec.go#L15)
oasis_finalized_rounds | Number of finalized rounds. | [roothash](../../go/roothash/metrics.go#L14)
oasis_grpc_calls | Number of gRPC calls. | [common/grpc](../../go/common/grpc/grpc.go#L37)
oasis_grpc_latency | gRPC call latency (seconds). | [common/grpc](../../go/common/grpc/grpc.go#L39)
oasis_grpc_stream_writes | Number of gRPC stream writes. | [common/grpc](../../go/common/grpc/grpc.go#L41)
oasis_node_cpu_stime_seconds | CPU system time spent by worker as reported by /proc/&lt;PID&gt;/stat (seconds). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/cpu.go#L14)
oasis_node_cpu_utime_seconds | CPU user time spent by worker as reported by /proc/&lt;PID&gt;/stat (seconds). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/cpu.go#L12)
oasis_node_disk_read_bytes | Read data from block storage by the worker as reported by /proc/&lt;PID&gt;/io (bytes). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/disk.go#L17)
oasis_node_disk_usage_bytes | Size of datadir of the worker (bytes). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/disk.go#L15)
oasis_node_disk_written_bytes | Written data from block storage by the worker as reported by /proc/&lt;PID&gt;/io (bytes) | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/disk.go#L19)
oasis_node_mem_rss_anon_bytes | Size of resident anonymous memory of worker as reported by /proc/&lt;PID&gt;/status (bytes). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/mem.go#L14)
oasis_node_mem_rss_file_bytes | Size of resident file mappings of worker as reported by /proc/&lt;PID&gt;/status (bytes) | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/mem.go#L16)
oasis_node_mem_vm_size_bytes | Virtual memory size of worker (bytes). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/mem.go#L12)
oasis_node_net_receive_bytes_total | Received data for each network device as reported by /proc/net/dev (bytes). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/net.go#L11)
oasis_node_net_receive_packets_total | Received data for each network device as reported by /proc/net/dev (packets). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/net.go#L13)
oasis_node_net_transmit_bytes_total | Transmitted data for each network device as reported by /proc/net/dev (bytes). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/net.go#L15)
oasis_node_net_transmit_packets_total | Transmitted data for each network device as reported by /proc/net/dev (packets). | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/net.go#L17)
oasis_registry_entities | Number of registry entities. | [registry](../../go/registry/metrics.go#L19)
oasis_registry_nodes | Number of registry nodes. | [registry](../../go/registry/metrics.go#L17)
oasis_registry_runtimes | Number of registry runtimes. | [registry](../../go/registry/metrics.go#L21)
oasis_roothash_block_interval | Time between roothash blocks (seconds). | [roothash](../../go/roothash/metrics.go#L16)
oasis_storage_failures | Number of storage failures. | [storage](../../go/storage/metrics.go#L15)
oasis_storage_latency | Storage call latency (seconds). | [storage](../../go/storage/metrics.go#L19)
oasis_storage_successes | Number of storage successes. | [storage](../../go/storage/metrics.go#L17)
oasis_storage_value_size | Storage call value size (bytes). | [storage](../../go/storage/metrics.go#L21)
oasis_up | Is oasis-test-runner active for specific test. | [oasis-node/cmd/common/metrics](../../go/oasis-node/cmd/common/metrics/metrics.go#L31)
oasis_worker_aborted_batch_count | Number of aborted batches. | [worker/compute/executor/committee](../../go/worker/compute/executor/committee/node.go#L40)
oasis_worker_aborted_merge_count | Number of aborted merges. | [worker/compute/merge/committee](../../go/worker/compute/merge/committee/node.go#L36)
oasis_worker_batch_processing_time | Time it takes for a batch to finalize (seconds). | [worker/compute/executor/committee](../../go/worker/compute/executor/committee/node.go#L46)
oasis_worker_batch_read_time | Time it takes to read a batch from storage (seconds). | [worker/compute/executor/committee](../../go/worker/compute/executor/committee/node.go#L44)
oasis_worker_batch_runtime_processing_time | Time it takes for a batch to be processed by the runtime (seconds). | [worker/compute/executor/committee](../../go/worker/compute/executor/committee/node.go#L48)
oasis_worker_batch_size | Number of transactions in a batch. | [worker/compute/executor/committee](../../go/worker/compute/executor/committee/node.go#L50)
oasis_worker_epoch_transition_count | Number of epoch transitions. | [worker/common/committee](../../go/worker/common/committee/node.go#L29)
oasis_worker_execution_discrepancy_detected_count | Number of detected execute discrepancies. | [worker/compute/executor/committee](../../go/worker/compute/executor/committee/node.go#L38)
oasis_worker_failed_round_count | Number of failed roothash rounds. | [worker/common/committee](../../go/worker/common/committee/node.go#L27)
oasis_worker_inconsistent_merge_root_count | Number of inconsistent merge roots. | [worker/compute/merge/committee](../../go/worker/compute/merge/committee/node.go#L38)
oasis_worker_merge_discrepancy_detected_count | Number of detected merge discrepancies. | [worker/compute/merge/committee](../../go/worker/compute/merge/committee/node.go#L32)
oasis_worker_processed_block_count | Number of processed roothash blocks. | [worker/common/committee](../../go/worker/common/committee/node.go#L23)
oasis_worker_processed_event_count | Number of processed roothash events. | [worker/common/committee](../../go/worker/common/committee/node.go#L25)
oasis_worker_roothash_merge_commit_latency | Latency of roothash merge commit (seconds). | [worker/compute/merge/committee](../../go/worker/compute/merge/committee/node.go#L34)
oasis_worker_storage_commit_latency | Latency of storage commit calls (state + outputs) (seconds). | [worker/compute/executor/committee](../../go/worker/compute/executor/committee/node.go#L42)
oasis_worker_txnscheduler_incoming_queue_size | Size of the incoming queue (number of entries). | [worker/compute/txnscheduler/committee](../../go/worker/compute/txnscheduler/committee/node.go#L39)
<!-- End of generated table -->

<!-- markdownlint-enable line-length -->

## List of Metrics Reported by *Tendermint*

Since `oasis-node` uses *Tendermint* for BFT consensus, all *Tendermint* metrics are also reported.
Consult [tendermint-core documentation](https://docs.tendermint.com/master/tendermint-core/metrics.html)
for a list of *Tendermint* metrics.
